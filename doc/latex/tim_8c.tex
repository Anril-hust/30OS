\hypertarget{tim_8c}{}\section{src/tim.c File Reference}
\label{tim_8c}\index{src/tim.\+c@{src/tim.\+c}}


basic functions related to timer.  


{\ttfamily \#include \char`\"{}tim.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{tim_8c_aaa3738d48efb847af0a44f6eef2bad42}{interrupt\+\_\+handler\+\_\+0x20} (int32 $\ast$esp)
\begin{DoxyCompactList}\small\item\em timer interrupt. \end{DoxyCompactList}\item 
void \hyperlink{group__tim_ga7624bf709371205b24452df8ca316ab2}{tim\+\_\+init} ()
\begin{DoxyCompactList}\small\item\em init timer\+Ctl. \end{DoxyCompactList}\item 
boolean \hyperlink{group__tim_gad08548924a886c19bed954663f37a63f}{timer\+\_\+add} (I\+N uint32 timeout, O\+U\+T \hyperlink{struct_t_i_m}{T\+I\+M} $\ast$$\ast$timer)
\begin{DoxyCompactList}\small\item\em create a timer, add the timer into sorted\+Timer list. \end{DoxyCompactList}\item 
boolean \hyperlink{group__tim_gacc23aa4ba2de1eb3a33370bee74080ad}{timer\+\_\+set\+\_\+timeout} (I\+N \hyperlink{struct_t_i_m}{T\+I\+M} $\ast$timer, I\+N uint32 timeout)
\begin{DoxyCompactList}\small\item\em reset timeout value of timer. \end{DoxyCompactList}\item 
boolean \hyperlink{group__tim_ga9eae53f097274f823e918123904397a4}{timer\+\_\+del} (I\+N \hyperlink{struct_t_i_m}{T\+I\+M} $\ast$timer)
\begin{DoxyCompactList}\small\item\em delete one timer. \end{DoxyCompactList}\item 
boolean \hyperlink{group__tim_ga0d1983206eda05d809414ba0a3c0b539}{timer\+\_\+is\+\_\+valid} (I\+N \hyperlink{struct_t_i_m}{T\+I\+M} $\ast$timer)
\begin{DoxyCompactList}\small\item\em test whether the timer is valid. \end{DoxyCompactList}\item 
uint32 \hyperlink{group__tim_ga4c60fc359f9528c3a6a83c00f6931f65}{timer\+\_\+getcount} ()
\begin{DoxyCompactList}\small\item\em get current time counter. \end{DoxyCompactList}\item 
void \hyperlink{group__tim_gad52b255bc6d45dd3da0df719cd58ef4c}{tim\+\_\+revise} ()
\begin{DoxyCompactList}\small\item\em internal called function. \end{DoxyCompactList}\item 
void \hyperlink{group__tim_ga0962091b087a076d07dbd0f2de6100f4}{tim\+\_\+sort} ()
\begin{DoxyCompactList}\small\item\em sort the timer in sorted\+Timer\mbox{[}\mbox{]} list. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{struct_t_i_m___c_t_l}{T\+I\+M\+\_\+\+C\+T\+L} \hyperlink{group__tim_gaafedf127c23194e2418754189b320aa2}{timer\+Ctl}
\begin{DoxyCompactList}\small\item\em The struct used to hold all timers. \end{DoxyCompactList}\item 
\hypertarget{tim_8c_a1f4deeba48b4ee0a3b4de5e0583b5e7a}{}\hyperlink{struct_t_i_m}{T\+I\+M} $\ast$ \hyperlink{tim_8c_a1f4deeba48b4ee0a3b4de5e0583b5e7a}{task\+\_\+timer}\label{tim_8c_a1f4deeba48b4ee0a3b4de5e0583b5e7a}

\begin{DoxyCompactList}\small\item\em the timer used to switch tasks. \end{DoxyCompactList}\item 
\hypertarget{tim_8c_a3ff412d5f2be2f4f33ac8669df7b363f}{}\hyperlink{struct_t_a_s_k___c_t_l}{T\+A\+S\+K\+\_\+\+C\+T\+L} \hyperlink{tim_8c_a3ff412d5f2be2f4f33ac8669df7b363f}{task\+Ctl}\label{tim_8c_a3ff412d5f2be2f4f33ac8669df7b363f}

\begin{DoxyCompactList}\small\item\em taskes control block used to control switch tasks. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
basic functions related to timer. 

The timer including create timer, start timer, stop timer, delete timer. etc. 

\subsection{Function Documentation}
\hypertarget{tim_8c_aaa3738d48efb847af0a44f6eef2bad42}{}\index{tim.\+c@{tim.\+c}!interrupt\+\_\+handler\+\_\+0x20@{interrupt\+\_\+handler\+\_\+0x20}}
\index{interrupt\+\_\+handler\+\_\+0x20@{interrupt\+\_\+handler\+\_\+0x20}!tim.\+c@{tim.\+c}}
\subsubsection[{interrupt\+\_\+handler\+\_\+0x20}]{\setlength{\rightskip}{0pt plus 5cm}void interrupt\+\_\+handler\+\_\+0x20 (
\begin{DoxyParamCaption}
\item[{int32 $\ast$}]{esp}
\end{DoxyParamCaption}
)}\label{tim_8c_aaa3738d48efb847af0a44f6eef2bad42}


timer interrupt. 

Add global timecounter. check sorted\+Timer\mbox{[}\mbox{]} in timer\+Ctl to see if there are some timers which are timeout. Put the timeout timer to timer\+Ctl.\+timeout\+Timer\mbox{[}\mbox{]}. check sleep tasks list in task\+Ctl, if the task has sleep for enough time, wake up them and call scheduler. 
\begin{DoxyParams}{Parameters}
{\em esp} & stack pointer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
N\+U\+L\+L 
\end{DoxyReturn}
$<$ 把\+I\+R\+Q-\/00信号接收结束的信息通知给\+P\+I\+C

$<$ 有定时器超时

找到超时的 sleep 队列中的位置

将所有超时的任务放到运行队列中

从 sleep 队列中删掉这些任务

进行调度 