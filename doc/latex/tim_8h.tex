\hypertarget{tim_8h}{}\section{src/tim.h File Reference}
\label{tim_8h}\index{src/tim.\+h@{src/tim.\+h}}


basic functions related to timer.  


{\ttfamily \#include \char`\"{}typedef.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}interrupt.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}func\+Utils.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}multi\+Task.\+h\char`\"{}}\\*
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{struct_t_i_m}{T\+I\+M}
\begin{DoxyCompactList}\small\item\em structure of one timer. \end{DoxyCompactList}\item 
struct \hyperlink{struct_t_i_m___c_t_l}{T\+I\+M\+\_\+\+C\+T\+L}
\begin{DoxyCompactList}\small\item\em structure of global timer\+Ctl. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\hypertarget{group__hal_ga92ff76b55680dfe73f95c2031d122c88}{}\#define \hyperlink{group__hal_ga92ff76b55680dfe73f95c2031d122c88}{P\+I\+T\+\_\+\+C\+T\+R\+L}~0x0043\label{group__hal_ga92ff76b55680dfe73f95c2031d122c88}

\begin{DoxyCompactList}\small\item\em B\+I\+O\+S used, related to timer. \end{DoxyCompactList}\item 
\hypertarget{group__hal_ga09e4f04647b9697c00fd5c4a20b73c2a}{}\#define \hyperlink{group__hal_ga09e4f04647b9697c00fd5c4a20b73c2a}{P\+I\+T\+\_\+\+C\+N\+T0}~0x0040\label{group__hal_ga09e4f04647b9697c00fd5c4a20b73c2a}

\begin{DoxyCompactList}\small\item\em B\+I\+O\+S used, related to timer. \end{DoxyCompactList}\item 
\hypertarget{group__tim_ga631a00e0b5343d37814e14770345ff9b}{}\#define \hyperlink{group__tim_ga631a00e0b5343d37814e14770345ff9b}{M\+A\+X\+\_\+\+T\+I\+M\+E\+R}~256\label{group__tim_ga631a00e0b5343d37814e14770345ff9b}

\begin{DoxyCompactList}\small\item\em max number of timer can be created. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \hyperlink{struct_t_i_m}{T\+I\+M} \hyperlink{group__tim_ga26669a4a8b52c4fd916ee5faf066be19}{T\+I\+M}
\begin{DoxyCompactList}\small\item\em structure of one timer. \end{DoxyCompactList}\item 
typedef struct \hyperlink{struct_t_i_m___c_t_l}{T\+I\+M\+\_\+\+C\+T\+L} \hyperlink{group__tim_ga4091d5ac2e18168e0642a8e7fb363590}{T\+I\+M\+\_\+\+C\+T\+L}
\begin{DoxyCompactList}\small\item\em structure of global timer\+Ctl. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{tim_8h_aaa3738d48efb847af0a44f6eef2bad42}{interrupt\+\_\+handler\+\_\+0x20} (int32 $\ast$esp)
\begin{DoxyCompactList}\small\item\em timer interrupt. \end{DoxyCompactList}\item 
void \hyperlink{group__tim_ga7624bf709371205b24452df8ca316ab2}{tim\+\_\+init} ()
\begin{DoxyCompactList}\small\item\em init timer\+Ctl. \end{DoxyCompactList}\item 
boolean \hyperlink{group__tim_gad08548924a886c19bed954663f37a63f}{timer\+\_\+add} (I\+N uint32 timeout, O\+U\+T \hyperlink{struct_t_i_m}{T\+I\+M} $\ast$$\ast$timer)
\begin{DoxyCompactList}\small\item\em create a timer, add the timer into sorted\+Timer list. \end{DoxyCompactList}\item 
boolean \hyperlink{group__tim_gacc23aa4ba2de1eb3a33370bee74080ad}{timer\+\_\+set\+\_\+timeout} (I\+N \hyperlink{struct_t_i_m}{T\+I\+M} $\ast$timer, I\+N uint32 timeout)
\begin{DoxyCompactList}\small\item\em reset timeout value of timer. \end{DoxyCompactList}\item 
boolean \hyperlink{group__tim_ga9eae53f097274f823e918123904397a4}{timer\+\_\+del} (I\+N \hyperlink{struct_t_i_m}{T\+I\+M} $\ast$timer)
\begin{DoxyCompactList}\small\item\em delete one timer. \end{DoxyCompactList}\item 
boolean \hyperlink{group__tim_ga0d1983206eda05d809414ba0a3c0b539}{timer\+\_\+is\+\_\+valid} (I\+N \hyperlink{struct_t_i_m}{T\+I\+M} $\ast$timer)
\begin{DoxyCompactList}\small\item\em test whether the timer is valid. \end{DoxyCompactList}\item 
uint32 \hyperlink{group__tim_ga4c60fc359f9528c3a6a83c00f6931f65}{timer\+\_\+getcount} ()
\begin{DoxyCompactList}\small\item\em get current time counter. \end{DoxyCompactList}\item 
void \hyperlink{group__tim_gad52b255bc6d45dd3da0df719cd58ef4c}{tim\+\_\+revise} ()
\begin{DoxyCompactList}\small\item\em internal called function. \end{DoxyCompactList}\item 
void \hyperlink{group__tim_ga0962091b087a076d07dbd0f2de6100f4}{tim\+\_\+sort} ()
\begin{DoxyCompactList}\small\item\em sort the timer in sorted\+Timer\mbox{[}\mbox{]} list. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
basic functions related to timer. 

The timer including create timer, start timer, stop timer, delete timer. etc. 

\subsection{Function Documentation}
\hypertarget{tim_8h_aaa3738d48efb847af0a44f6eef2bad42}{}\index{tim.\+h@{tim.\+h}!interrupt\+\_\+handler\+\_\+0x20@{interrupt\+\_\+handler\+\_\+0x20}}
\index{interrupt\+\_\+handler\+\_\+0x20@{interrupt\+\_\+handler\+\_\+0x20}!tim.\+h@{tim.\+h}}
\subsubsection[{interrupt\+\_\+handler\+\_\+0x20}]{\setlength{\rightskip}{0pt plus 5cm}void interrupt\+\_\+handler\+\_\+0x20 (
\begin{DoxyParamCaption}
\item[{int32 $\ast$}]{esp}
\end{DoxyParamCaption}
)}\label{tim_8h_aaa3738d48efb847af0a44f6eef2bad42}


timer interrupt. 

Add global timecounter. check sorted\+Timer\mbox{[}\mbox{]} in timer\+Ctl to see if there are some timers which are timeout. Put the timeout timer to timer\+Ctl.\+timeout\+Timer\mbox{[}\mbox{]}. check sleep tasks list in task\+Ctl, if the task has sleep for enough time, wake up them and call scheduler. 
\begin{DoxyParams}{Parameters}
{\em esp} & stack pointer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
N\+U\+L\+L 
\end{DoxyReturn}
$<$ 把\+I\+R\+Q-\/00信号接收结束的信息通知给\+P\+I\+C

$<$ 有定时器超时

找到超时的 sleep 队列中的位置

将所有超时的任务放到运行队列中

从 sleep 队列中删掉这些任务

进行调度 